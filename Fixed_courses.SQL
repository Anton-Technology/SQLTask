CREATE TABLE addr (
 id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 street VARCHAR(100),
 zip INT,
 city VARCHAR(100),
 UNIQUE(id)
);

ALTER TABLE addr ADD CONSTRAINT PK_addr PRIMARY KEY (id);


CREATE TABLE course_layout (
 course_code CHAR(6) NOT NULL,
 course_name VARCHAR(200) NOT NULL,
 min_students SMALLINT NOT NULL,
 max_students SMALLINT NOT NULL,
 hp NUMERIC(3,1) NOT NULL,
 UNIQUE(course_code)
);

ALTER TABLE course_layout ADD CONSTRAINT PK_course_layout PRIMARY KEY (course_code);


CREATE TABLE department (
 department_name VARCHAR(200) NOT NULL,
 manager_id INT,
 UNIQUE(department_name)
);

ALTER TABLE department ADD CONSTRAINT PK_department PRIMARY KEY (department_name);


CREATE TABLE employee (
 id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 salary INT NOT NULL,
 supervisor_id INT,
 person_number INT NOT NULL,
 department_name VARCHAR(200) NOT NULL,
 job_title_id INT,
 UNIQUE(id, person_number)
);

ALTER TABLE employee ADD CONSTRAINT PK_employee PRIMARY KEY (id);


CREATE TABLE job_title (
 id INT GENERATED ALWAYS AS IDENTITY NOT NULL,
 job_title VARCHAR(100) NOT NULL,
 UNIQUE(id, job_title)
);

ALTER TABLE job_title ADD CONSTRAINT PK_job_title PRIMARY KEY (id);


CREATE TABLE person (
 person_number INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 first_name VARCHAR(100) NOT NULL,
 last_name VARCHAR(100) NOT NULL,
 UNIQUE(person_number)
);

ALTER TABLE person ADD CONSTRAINT PK_person PRIMARY KEY (person_number);


CREATE TABLE person_addr (
 address_id INT NOT NULL,
 person_number INT NOT NULL
);

ALTER TABLE person_addr ADD CONSTRAINT PK_person_addr PRIMARY KEY (address_id,person_number);


CREATE TABLE phone (
 person_number INT NOT NULL,
 phone_numb VARCHAR(16) NOT NULL
);

ALTER TABLE phone ADD CONSTRAINT PK_phone PRIMARY KEY (person_number,phone_numb);


CREATE TABLE teaching_activity (
 activity_name VARCHAR(40) NOT NULL,
 factor NUMERIC(4,2) NOT NULL,
 UNIQUE(activity_name)
);

ALTER TABLE teaching_activity ADD CONSTRAINT PK_teaching_activity PRIMARY KEY (activity_name);


CREATE TABLE course_instance (
 id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 num_students SMALLINT NOT NULL,
 study_period CHAR(2) NOT NULL,
 study_year SMALLINT NOT NULL,
 course_code CHAR(6) NOT NULL,
 UNIQUE(id)
);

ALTER TABLE course_instance ADD CONSTRAINT PK_course_instance PRIMARY KEY (id);


CREATE TABLE planned_activity (
 id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
 planned_hours SMALLINT NOT NULL,
 activity_name VARCHAR(40) NOT NULL,
 instance_id INT NOT NULL,
 UNIQUE(id)
);

ALTER TABLE planned_activity ADD CONSTRAINT PK_planned_activity PRIMARY KEY (id);


CREATE TABLE plan_employee (
 employee_id INT NOT NULL,
 plan_id INT NOT NULL,
 alloc_hours SMALLINT
);

ALTER TABLE plan_employee ADD CONSTRAINT PK_plan_employee PRIMARY KEY (employee_id,plan_id);


ALTER TABLE department ADD CONSTRAINT FK_department_0 FOREIGN KEY (manager_id) REFERENCES employee (id);


ALTER TABLE employee ADD CONSTRAINT FK_employee_0 FOREIGN KEY (person_number) REFERENCES person (person_number);
ALTER TABLE employee ADD CONSTRAINT FK_employee_1 FOREIGN KEY (department_name) REFERENCES department (department_name);
ALTER TABLE employee ADD CONSTRAINT FK_employee_2 FOREIGN KEY (job_title_id) REFERENCES job_title (id);


ALTER TABLE person_addr ADD CONSTRAINT FK_person_addr_0 FOREIGN KEY (address_id) REFERENCES addr (id) ON DELETE CASCADE;
ALTER TABLE person_addr ADD CONSTRAINT FK_person_addr_1 FOREIGN KEY (person_number) REFERENCES person (person_number) ON DELETE CASCADE;


ALTER TABLE phone ADD CONSTRAINT FK_phone_0 FOREIGN KEY (person_number) REFERENCES person (person_number) ON DELETE CASCADE;


ALTER TABLE course_instance ADD CONSTRAINT FK_course_instance_0 FOREIGN KEY (course_code) REFERENCES course_layout (course_code) ON DELETE CASCADE;


ALTER TABLE planned_activity ADD CONSTRAINT FK_planned_activity_0 FOREIGN KEY (activity_name) REFERENCES teaching_activity (activity_name);
ALTER TABLE planned_activity ADD CONSTRAINT FK_planned_activity_1 FOREIGN KEY (instance_id) REFERENCES course_instance (id);


ALTER TABLE plan_employee ADD CONSTRAINT FK_plan_employee_0 FOREIGN KEY (employee_id) REFERENCES employee (id) ON DELETE CASCADE;
ALTER TABLE plan_employee ADD CONSTRAINT FK_plan_employee_1 FOREIGN KEY (plan_id) REFERENCES planned_activity (id) ON DELETE CASCADE;
